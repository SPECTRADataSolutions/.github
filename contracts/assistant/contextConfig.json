{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/SPECTRADataSolutions/.github/contracts/assistant/contextConfig.json",
  "title": "SPECTRA Context Server Configuration",
  "description": "Schema defining context server configuration with default-deny security",
  "type": "object",
  "properties": {
    "metadata": {
      "type": "object",
      "properties": {
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
          "description": "Configuration schema version"
        },
        "environment": {
          "type": "string",
          "enum": ["development", "staging", "production"],
          "description": "Deployment environment"
        },
        "lastUpdated": {
          "type": "string",
          "format": "date-time",
          "description": "ISO timestamp of last configuration update"
        }
      },
      "required": ["version", "environment", "lastUpdated"],
      "additionalProperties": false
    },
    "security": {
      "type": "object",
      "properties": {
        "defaultPolicy": {
          "type": "string",
          "enum": ["deny"],
          "description": "Default-deny access policy for all context servers"
        },
        "authenticationRequired": {
          "type": "boolean",
          "const": true,
          "description": "Authentication required for all context server access"
        },
        "auditLogging": {
          "type": "boolean",
          "const": true,
          "description": "Audit logging must be enabled"
        },
        "secretRedaction": {
          "type": "boolean",
          "const": true,
          "description": "Secret redaction must be enabled in logs"
        }
      },
      "required": ["defaultPolicy", "authenticationRequired", "auditLogging", "secretRedaction"],
      "additionalProperties": false
    },
    "contextServers": {
      "type": "object",
      "properties": {
        "data": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Whether data context server is enabled"
            },
            "endpoint": {
              "type": "string",
              "format": "uri",
              "description": "Context server endpoint URL"
            },
            "authentication": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["token", "bearer", "api-key"],
                  "description": "Authentication method"
                },
                "envVariable": {
                  "type": "string",
                  "pattern": "^[A-Z][A-Z0-9_]*$",
                  "description": "Environment variable containing credentials"
                }
              },
              "required": ["type", "envVariable"],
              "additionalProperties": false
            },
            "rateLimits": {
              "type": "object",
              "properties": {
                "requestsPerMinute": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 1000
                },
                "requestsPerHour": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 10000
                }
              },
              "required": ["requestsPerMinute", "requestsPerHour"],
              "additionalProperties": false
            },
            "allowedOperations": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["read", "search", "query"]
              },
              "description": "Explicitly allowed operations (no write operations)"
            }
          },
          "required": ["enabled", "endpoint", "authentication", "rateLimits", "allowedOperations"],
          "additionalProperties": false
        },
        "git": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Whether git context server is enabled"
            },
            "endpoint": {
              "type": "string",
              "format": "uri",
              "description": "Git context server endpoint URL"
            },
            "authentication": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["token", "github-app"],
                  "description": "Authentication method"
                },
                "envVariable": {
                  "type": "string",
                  "pattern": "^[A-Z][A-Z0-9_]*$",
                  "description": "Environment variable containing credentials"
                }
              },
              "required": ["type", "envVariable"],
              "additionalProperties": false
            },
            "rateLimits": {
              "type": "object",
              "properties": {
                "requestsPerMinute": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 100
                },
                "requestsPerHour": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 5000
                }
              },
              "required": ["requestsPerMinute", "requestsPerHour"],
              "additionalProperties": false
            },
            "allowedOperations": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["read", "search", "list", "clone"]
              },
              "description": "Explicitly allowed git operations"
            },
            "repositoryAllowlist": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": "^[a-zA-Z0-9._-]+/[a-zA-Z0-9._-]+$"
              },
              "description": "Allowed repositories in owner/repo format"
            }
          },
          "required": ["enabled", "endpoint", "authentication", "rateLimits", "allowedOperations", "repositoryAllowlist"],
          "additionalProperties": false
        },
        "ticketing": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Whether ticketing context server is enabled"
            },
            "endpoint": {
              "type": "string",
              "format": "uri",
              "description": "Ticketing system endpoint URL"
            },
            "authentication": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["token", "api-key", "oauth"],
                  "description": "Authentication method"
                },
                "envVariable": {
                  "type": "string",
                  "pattern": "^[A-Z][A-Z0-9_]*$",
                  "description": "Environment variable containing credentials"
                }
              },
              "required": ["type", "envVariable"],
              "additionalProperties": false
            },
            "rateLimits": {
              "type": "object",
              "properties": {
                "requestsPerMinute": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 500
                },
                "requestsPerHour": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 2000
                }
              },
              "required": ["requestsPerMinute", "requestsPerHour"],
              "additionalProperties": false
            },
            "allowedOperations": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["read", "search", "list", "create", "update"]
              },
              "description": "Explicitly allowed ticketing operations"
            },
            "projectAllowlist": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Allowed project IDs or keys"
            }
          },
          "required": ["enabled", "endpoint", "authentication", "rateLimits", "allowedOperations", "projectAllowlist"],
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "monitoring": {
      "type": "object",
      "properties": {
        "metricsEnabled": {
          "type": "boolean",
          "const": true,
          "description": "Performance metrics collection enabled"
        },
        "healthChecks": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "const": true
            },
            "intervalSeconds": {
              "type": "integer",
              "minimum": 30,
              "maximum": 600
            }
          },
          "required": ["enabled", "intervalSeconds"],
          "additionalProperties": false
        },
        "alerting": {
          "type": "object",
          "properties": {
            "errorThreshold": {
              "type": "number",
              "minimum": 0.01,
              "maximum": 0.1,
              "description": "Error rate threshold for alerting (0.01 = 1%)"
            },
            "latencyThreshold": {
              "type": "integer",
              "minimum": 100,
              "maximum": 10000,
              "description": "Response latency threshold in milliseconds"
            }
          },
          "required": ["errorThreshold", "latencyThreshold"],
          "additionalProperties": false
        }
      },
      "required": ["metricsEnabled", "healthChecks", "alerting"],
      "additionalProperties": false
    }
  },
  "required": ["metadata", "security", "contextServers", "monitoring"],
  "additionalProperties": false
}