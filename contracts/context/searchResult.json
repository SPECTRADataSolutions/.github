{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/SPECTRADataSolutions/.github/contracts/context/searchResult.json",
  "title": "SPECTRA Context Search Result Schema",
  "description": "Schema for search results returned by spectra.search.find endpoint",
  "type": "object",
  "properties": {
    "query": {
      "type": "object",
      "description": "Original query specification including text and optional filters/pagination parameters",
      "properties": {
        "text": {
          "type": "string",
          "minLength": 1,
          "maxLength": 500,
          "description": "Original search query text"
        },
        "filters": {
          "type": "object",
            "description": "Structured filters applied to the search",
          "properties": {
            "dream": {
              "type": "string",
              "enum": ["SPECTRA"]
            },
            "archetype": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["Guidance", "Innovation", "Engagement", "Operations", "Protection", "Sustenance", "Growth"]
              },
              "uniqueItems": true
            },
            "domain": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": "^[a-z][a-zA-Z]*$"
              },
              "uniqueItems": true
            },
            "tags": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": "^[a-z][a-zA-Z0-9]*$"
              },
              "uniqueItems": true
            },
            "roles": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "uniqueItems": true
            },
            "mimeType": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "text/plain",
                  "text/markdown",
                  "application/json",
                  "application/yaml",
                  "text/yaml",
                  "application/xml",
                  "text/xml"
                ]
              },
              "uniqueItems": true
            },
            "minScore": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Optional minimum relevance score threshold"
            }
          },
          "additionalProperties": false
        },
        "limit": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 10,
          "description": "Maximum number of results to return"
        },
        "offset": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "description": "Number of results to skip for pagination"
        }
      },
      "required": ["text"],
      "additionalProperties": false
    },
    "results": {
      "type": "array",
      "description": "Array of search results ordered by relevance (highest first)",
      "maxItems": 100,
      "items": {
        "type": "object",
        "properties": {
          "anchorId": {
            "type": "string",
            "pattern": "^[a-z][a-zA-Z0-9]*$",
            "description": "Identifier of the anchor (matches anchor.id pattern)"
          },
          "title": {
            "type": "string",
            "description": "Anchor title for display"
          },
            "description": {
              "type": "string",
              "description": "Anchor description (may include highlight markup)"
            },
          "score": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Relevance score (0â€“1, higher is more relevant)"
          },
          "snippet": {
            "type": "string",
            "description": "Representative content excerpt with highlights (if available)"
          },
          "highlights": {
            "type": "array",
            "description": "List of highlight fragments matched in the search",
            "items": {
              "type": "object",
              "properties": {
                "field": {
                  "type": "string",
                  "enum": ["title", "description", "content", "tags"]
                },
                "snippet": {
                  "type": "string",
                  "maxLength": 200,
                  "description": "Text snippet with highlighting applied"
                },
                "startPos": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Start character position in original field (optional)"
                },
                "endPos": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "End character position in original field (optional)"
                }
              },
              "required": ["field", "snippet"],
              "additionalProperties": false
            }
          },
          "metadata": {
            "type": "object",
            "description": "Semantic classification metadata associated with the anchor",
            "properties": {
              "dream": {
                "type": "string",
                "enum": ["SPECTRA"]
              },
              "archetype": {
                "type": "string",
                "enum": ["Guidance", "Innovation", "Engagement", "Operations", "Protection", "Sustenance", "Growth"]
              },
              "domain": {
                "type": "string",
                "pattern": "^[a-z][a-zA-Z]*$"
              },
              "tags": {
                "type": "array",
                "items": {
                  "type": "string",
                  "pattern": "^[a-z][a-zA-Z0-9]*$"
                },
                "uniqueItems": true
              },
              "roles": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "uniqueItems": true
              },
              "mimeType": {
                "type": "string",
                "enum": [
                  "text/plain",
                  "text/markdown",
                  "application/json",
                  "application/yaml",
                  "text/yaml",
                  "application/xml",
                  "text/xml"
                ]
              },
              "sizeBytes": {
                "type": "integer",
                "minimum": 0
              },
              "matchCount": {
                "type": "integer",
                "minimum": 0,
                "description": "Number of matched terms/fragments contributing to score"
              }
            },
            "required": ["dream", "archetype", "domain"],
            "additionalProperties": false
          },
          "repository": {
            "type": "object",
            "description": "Repository contextual location of the anchor",
            "properties": {
              "owner": {
                "type": "string",
                "enum": ["SPECTRADataSolutions"]
              },
              "name": {
                "type": "string",
                "pattern": "^[a-zA-Z0-9._-]+$"
              },
              "path": {
                "type": "string",
                "description": "File path within the repository"
              },
              "ref": {
                "type": "string",
                "pattern": "^[a-f0-9]{40}$",
                "description": "Commit SHA (immutable reference) if pinned"
              }
            },
            "required": ["owner", "name", "path"],
            "additionalProperties": false
          },
          "privacy": {
            "type": "object",
            "description": "Privacy/redaction indicators for the result content",
            "properties": {
              "redacted": {
                "type": "boolean",
                "default": false
              },
              "redactionCount": {
                "type": "integer",
                "minimum": 0
              },
              "isPrivateRepo": {
                "type": "boolean"
              }
            },
            "additionalProperties": false
          }
        },
        "required": ["anchorId", "title", "description", "score", "metadata", "repository"],
        "additionalProperties": false
      }
    },
    "pagination": {
      "type": "object",
      "description": "Pagination state for the current result window",
      "properties": {
        "total": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of matching results across all pages"
        },
        "limit": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100
        },
        "offset": {
          "type": "integer",
          "minimum": 0
        },
        "hasMore": {
          "type": "boolean",
          "description": "True if additional results exist beyond current window"
        }
      },
      "required": ["total", "limit", "offset", "hasMore"],
      "additionalProperties": false
    },
    "performance": {
      "type": "object",
      "description": "Execution and index performance metadata",
      "properties": {
        "queryTimeMs": {
          "type": "integer",
          "minimum": 0,
          "description": "End-to-end query execution time in milliseconds"
        },
        "cacheHit": {
          "type": "boolean",
          "description": "Indicates if results were served from cache"
        },
        "indexedCount": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of anchors currently in the search index"
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["query", "results", "pagination"],
  "additionalProperties": false
}